<script>
var options = {
	template: '../lib/pair/imitate.html',
	id: 'generic_imitate',
	svg: '<?xml version="1.0" encoding="utf-8"?>\n<!-- Generator: Adobe Illustrator 17.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  -->\n<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">\n<svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:pulse="pulse" xmlns:show="show" xmlns:hide="hide" x="0px" y="0px"\n\t width="115.298px" height="285.141px" viewBox="0 0 115.298 285.141" enable-background="new 0 0 115.298 285.141"\n\t xml:space="preserve">\n<path fill="#040202" d="M2.835,186.01c19.074,8.097,37.75,12.146,56.027,12.146c18.256,0,36.124-4.036,53.602-12.109V3.713\n\tc0-0.24-0.1-0.46-0.259-0.62c-0.16-0.16-0.379-0.259-0.62-0.259H3.713c-0.242,0-0.463,0.098-0.622,0.257l0.002,0.003\n\tc-0.16,0.16-0.259,0.379-0.259,0.62L2.835,186.01L2.835,186.01z M3.713,0h107.871c1.023,0,1.952,0.418,2.624,1.09\n\ts1.09,1.601,1.09,2.624v277.714c0,1.019-0.418,1.946-1.09,2.618v0.005c-0.672,0.672-1.601,1.09-2.624,1.09H3.713\n\tc-1.018,0-1.946-0.418-2.618-1.09l-0.005-0.005c-0.672-0.673-1.09-1.6-1.09-2.618V3.713C0,2.691,0.417,1.762,1.09,1.09h0.005\n\tC1.768,0.418,2.695,0,3.713,0z"/>\n<path fill="#040202" d="M86.092,87.267c-6.687-6.687-15.925-10.823-26.129-10.823S40.52,80.58,33.833,87.267\n\tS23.01,103.192,23.01,113.396s4.136,19.442,10.823,26.129s15.925,10.823,26.129,10.823s19.442-4.136,26.129-10.823\n\ts10.823-15.925,10.823-26.129C96.915,103.192,92.778,93.953,86.092,87.267 M59.962,75.026c10.595,0,20.188,4.295,27.132,11.238\n\tc6.943,6.943,11.238,16.536,11.238,27.132c0,10.595-4.295,20.188-11.238,27.132c-6.943,6.943-16.536,11.238-27.131,11.238\n\ts-20.188-4.295-27.132-11.238c-6.943-6.943-11.238-16.536-11.238-27.132c0-10.595,4.295-20.188,11.238-27.131\n\tC39.774,79.321,49.367,75.026,59.962,75.026z"/>\n<path fill="#040202" d="M81.754,91.604c-5.577-5.577-13.281-9.026-21.792-9.026s-16.215,3.449-21.792,9.026\n\ts-9.026,13.281-9.026,21.792c0,8.51,3.45,16.215,9.026,21.792s13.281,9.026,21.792,9.026s16.215-3.449,21.792-9.026\n\ts9.026-13.282,9.026-21.792C90.78,104.886,87.331,97.181,81.754,91.604 M59.962,79.743c9.292,0,17.706,3.767,23.796,9.857\n\ts9.857,14.503,9.857,23.796c0,9.292-3.767,17.706-9.857,23.796c-6.09,6.09-14.504,9.857-23.796,9.857s-17.706-3.767-23.796-9.857\n\ts-9.857-14.504-9.857-23.796S30.076,95.69,36.166,89.6C42.257,83.51,50.67,79.743,59.962,79.743z"/>\n<path pulse:initial="true" pulse:address=".*" fill="#040202" d="M81.754,91.604c-5.577-5.577-13.281-9.026-21.792-9.026s-16.215,3.449-21.792,9.026\n\ts-9.026,13.281-9.026,21.792c0,8.51,3.45,16.215,9.026,21.792s13.281,9.026,21.792,9.026s16.215-3.449,21.792-9.026\n\ts9.026-13.282,9.026-21.792C90.78,104.886,87.331,97.181,81.754,91.604z"/>\n</svg>\n',
	title: 'views.generic_imitate.title',
	body: 'views.generic_imitate.body',
	svgWidth: '80vw',
	svgHeight: '70vh',
	initWithDeviceData: false,
	previous: true,
	next: false
};
Homey.setTitle(__(options.title || ''));
Homey.emit('init', options.id);
Homey.on('show_view', function(viewId){
	Homey.showView(viewId);
});
Homey.on('close', function(){
	Homey.close();
});
Homey.on('nextView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) + 1;
	if(viewIndex > 0 && viewIndex < viewsIds.length){
		Homey.showView(viewsIds[viewIndex]);
	}
});
Homey.on('previousView', function(viewsIds){
	var viewIndex = viewsIds.indexOf(options.id) - 1;
	if(viewIndex >= 0){
		Homey.showView(viewsIds[viewIndex]);
	}
});
function nextView(){
	if(options.next){
		Homey.nextView();
	}else{
		Homey.emit('next');
	}
}
</script>

<link href="../../../assets/433_generator/css/styles.css" rel="stylesheet" type="text/css"/>

<link href="../../../assets/433_generator/css/svg.css" rel="stylesheet" type="text/css"/>

<script src="../../../assets/433_generator/js/svghighlighter.js" type="text/javascript"></script>

<div class="centered-container">
	<div id="image-container"></div>
	<div id="body"><span class="content"></span></div>
	<div class="foundAnimation" id="foundBackground" style="display:none;"></div>
	<i class="fa fa-check-circle foundAnimation" id="found" style="display:none;" aria-hidden="true"></i>
</div>

<script>
	var idPrefix = '[data-id="' + options.id + '"] ';
	$(idPrefix + '#body > span').html(__(options.body));
	var $imageContainer = $(idPrefix + '#image-container');
	$imageContainer.css('width', options.svgWidth).css('height', options.svgHeight);

	$imageContainer.html(options.svg);
	$imageContainer.highlight();

	var found = false;
	Homey.on('frame', function (data) {
		console.log('GOT FRAME', data);
		if(!found) {
			found = true;
			Homey.emit('set_device', data, function (err, device) {
				if (err) {
					if((err.message || err) !== '433_generator.error.invalid_device') {
						Homey.alert(err.message && err.message.indexOf(' ') === -1 && __(err.message) !== err.message ? __(err.message) : JSON.stringify(err));
					}
					found = false;
					return;
				}
				const dataKey = JSON.stringify(device.data);
				window.selected_devices = [ dataKey ];
				window.found_devices = {};
				window.found_devices[dataKey] = device;
				var $foundElems = $(idPrefix + '.foundAnimation');
				$foundElems.show();
				setTimeout(function () {
					$foundElems.addClass('fadeOut');
					setTimeout(nextView, 400);
				}, 500);
			});
		}
	});
</script>

<style>
	#found {
		z-index: 2;
		position: absolute;
		top: 20vh;
		left: 38vw;
		font-size: 30vh;
		color: #080;
		opacity: 1;
	}

	#foundBackground {
		z-index: 1;
		top: 0;
		bottom: 0;
		left: 0;
		right: 0;
		position: absolute;
		background-color: #FFF;
		opacity: 0.8;
	}

	.fadeOut {
		-webkit-transition: all 0.5s ease-in-out;
		-moz-transition: all 0.5s ease-in-out;
		-ms-transition: all 0.5s ease-in-out;
		-o-transition: all 0.5s ease-in-out;
		transition: all 0.5s ease-in-out;
		opacity: 0 !important;
	}
</style>